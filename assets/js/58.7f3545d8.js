(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{434:function(a,s,t){"use strict";t.r(s);var e=t(28),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("BackWikiBtn",{attrs:{id:"opq-wiki"}}),a._v(" "),t("h1",{attrs:{id:"定时任务管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定时任务管理"}},[a._v("#")]),a._v(" 定时任务管理")]),a._v(" "),t("p",[a._v("1 内置定时模块 全平台运行\n2 支持Cron表达式\n3 支持任务执行次数\n4 ...")]),a._v(" "),t("p",[t("strong",[a._v("使用起来非常灵活,使用场景考也考虑了不少 如 1⃣️每日的问候 早安晚安 2⃣️ 执行指定次数并销毁任务 3⃣️ 执行任意系统命令(基于lua os模块) 自动化运维将会非常的方便 ..")])]),a._v(" "),t("p",[t("strong",[a._v("原理：通过定时执行 "),t("code",[a._v("CronSchedules")]),a._v("文件夹下的任意脚本任意方法这样设计扩展起来也比较灵活")])]),a._v(" "),t("p",[t("strong",[a._v("在 "),t("code",[a._v("CronSchedules")]),a._v(" 目录下建立任意lua文件名作为任务调用执行的文件 任务的函数名任意 但是必须包含2个参数 如建立一个文件名为"),t("code",[a._v("CronDemo1.lua")]),a._v(" 函数为TaskOne(CurrentQQ, task)")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("function TaskOne(CurrentQQ, task)\n   return 1 --返回值为任意整数\nend\n")])])]),t("p",[t("strong",[t("a",{attrs:{href:"https://github.com/OPQBOT/OPQ/blob/master/Plugins/CronDemo1.lua",target:"_blank",rel:"noopener noreferrer"}},[a._v("详细的定时任务Luademo"),t("OutboundLink")],1)])]),a._v(" "),t("hr"),a._v(" "),t("h2",{attrs:{id:"webapi-对定时任务的管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webapi-对定时任务的管理"}},[a._v("#")]),a._v(" WEBAPI 对定时任务的管理")]),a._v(" "),t("h3",{attrs:{id:"增加任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加任务"}},[a._v("#")]),a._v(" 增加任务")]),a._v(" "),t("p",[a._v("URL:  http://127.0.0.1:8888/v1/LuaApiCaller")]),a._v(" "),t("h5",{attrs:{id:"请求信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#请求信息"}},[a._v("#")]),a._v(" 请求信息:")]),a._v(" "),t("p",[a._v("params:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("{\n'qq': 123456789,  #bot的QQ\n'funcname': 'AddCrons'\n}\n")])])]),t("p",[a._v("body(json):")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n    "QQ":"123456789",#执行任务的机器人\n    "Sepc":"0/5 * * * * ?",#cron表达式 每5秒执行一次\n    "FileName":"CronDemo1.lua",#执行的lua文件名\n    "FuncName":"TaskTwo" #执行的lua文件名下的TaskTwo方法名\n}\n')])])]),t("p",[a._v("response(json)")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n"Ret": 0,\n"TaskID": 1\n}\n')])])]),t("h3",{attrs:{id:"删除任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除任务"}},[a._v("#")]),a._v(" 删除任务")]),a._v(" "),t("p",[a._v("URL:  http://127.0.0.1:8888/v1/LuaApiCaller")]),a._v(" "),t("h5",{attrs:{id:"请求信息-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#请求信息-2"}},[a._v("#")]),a._v(" 请求信息:")]),a._v(" "),t("p",[a._v("params:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("{\n'qq': 123456789,  #bot的QQ\n'funcname': 'DelCrons'\n}\n")])])]),t("p",[a._v("body(json):")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n    "TaskID":2 #任务的ID\n}\n')])])]),t("p",[a._v("response(json)")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n"Msg": "成功",\n"Ret": 0\n}\n')])])]),t("h3",{attrs:{id:"获取任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取任务"}},[a._v("#")]),a._v(" 获取任务")]),a._v(" "),t("p",[a._v("URL:  http://127.0.0.1:8888/v1/LuaApiCaller")]),a._v(" "),t("h5",{attrs:{id:"请求信息-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#请求信息-3"}},[a._v("#")]),a._v(" 请求信息:")]),a._v(" "),t("p",[a._v("GET\nparams:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("{\n'qq': 123456789,  #bot的QQ\n'funcname': 'GetCrons'\n}\n")])])]),t("p",[a._v("response(json)")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n"Crons": "任务总数0\\n",\n"Ret": 0\n}\n')])])]),t("hr"),a._v(" "),t("h2",{attrs:{id:"lua-对定时任务的管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-对定时任务的管理"}},[a._v("#")]),a._v(" Lua 对定时任务的管理")]),a._v(" "),t("h3",{attrs:{id:"增加任务-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加任务-2"}},[a._v("#")]),a._v(" 增加任务")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('\nApi.Api_AddCrons(\n    {\n        QQ = "123456789",#执行任务的机器人\n        Sepc = "0/5 * * * * ?",#cron表达式 每5秒执行一次\n        FileName = "CronDemo1.lua",#执行的lua文件名\n        FuncName = "TaskOne" #执行的lua文件名下的TaskTwo方法名\n    })\n\n--仔细研究 就能发现 webapi提交的json 和lua 参数的映射关系  json对应lua里的Table 键去掉引号 :替换成=\n\n')])])]),t("h3",{attrs:{id:"删除任务-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除任务-2"}},[a._v("#")]),a._v(" 删除任务")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('Api.Api_DelCrons(task.TaskID)--传入任务整数\nstr = string.format("Ret %d Msg %s",task.Ret, task.Msg)\nlog.info("Api_DelCrons %s", str)\n\n')])])]),t("h3",{attrs:{id:"获取任务-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取任务-2"}},[a._v("#")]),a._v(" 获取任务")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('task=Api.Api_GetCrons()\nstr = string.format("Ret %d Crons %s",task.Ret, task.Crons)\nlog.info("Api_GetCrons %s", str)\n\n')])])])],1)}),[],!1,null,null,null);s.default=r.exports}}]);